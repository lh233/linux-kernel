请画出内存管理常用的数据结构关系图，例如mm_struct，vma，vaddr，page、pfn、pte、zone、paddr和pg_data等，并思考如下转换关系：

- 如何从mm数据结构和虚拟地址vaddr找到对应的VMA？
- 如何由page和VMA找到虚拟地址vaddr？
- 如何由page找到所有映射的VMA？
- 如何由VMA和虚拟地址vaddr找到相应的page数据结构？
- page和pfn之间的互换。
- pfn和paddr之间的互换。
- page和pte之间的互换。
- zone和page之间的互换。
- zone和pg_data之间的互换。



1. ## 内存管理数据结构的关系图

   在大部分Liux系统中，内存设备的初始化一般是在 BIOS或 bootloader中，然后把DDR的大小传递给Linux内核，因此从Linux 内核角度来看DDR，其实就是一段物理内存空间。在Linux内核中，和内存硬件物理特性相关的一些数据结构主要集中在MMU(处理器中内存管理单元)中，例如页表、cacheTLB操作等。因此大部分的Linux内核中关于内存管理的相关数据结构都是软件的概念中，例如mm、vma、zone.page.pgdata等。Linux内核中的内存管理中的数据结构错综复杂，归纳总结如图2.36所示

(1) 由mm数据结构和虚拟地址vaddr找到对应的VMA

内核提供相当多的 API来香找 VMA。

```
struct vm_area_struct * find_vma(struct mm_struct *mm,unsigned long addr);
struct vm_area_struct * find_vma_prv(struct mm_struct *mm,unsigned long addr,struct vm_area_struct **pprev);
struct vm_area_struct * find_vma_intersection
```



